# Critical Section (임계영역)
- 여러 프로세스가 또는 스레드가 공유 데이터(shared resource)에 접근하는 프로그램 코드 블록

&rarr; ***여러 프로세스가 동일 자원을 동시에 참조하여 값이 오염될 위험 가능성이 있는 영역***

- 공유하는 자원에 동시에 접근하는 경우, 스레드는 데이터와 힙 영역을 공유하기에 어떤 스레드가 다른 스레드에서 사용 중인 변수나 자료구조에 접근해 값을 수정할 수 있음

&rarr; ***따라서 동기화가 필요하며 프로그래밍 시 임계 영역을 최소화하는 설계를 해야함***

⇒ 하나의 메서드에 하나의 스레드만이 진입해서 실행(= mutual exclusion) 하는 메서드 영역 = Critical Section
but 불필요한 부분까지 동기화 하는 경우, 과도한 lock으로 병목 현상을 발생시켜 성능이 저하될 가능성이 높으므로 주의해야함

#### 여러 프로세스가 동시 접근하면 1. 데이터 불일치, 2. Race Condition, 3. Deadlock 등의 문제가 발생할 수 있으므로 이를 상호 배제(Mutual exclusion)방식으로 해결해야함 !


## Critical Section Problem
- 임계 영역을 만족하기 위해서는 아래 3가지 문제 소지들을 해결해야함

***1. Mutual Exclusion (상호 배제)***
- 한 순간에 오직 하나의 스레드만이 임계 영역에 진입할 수 있음을 보장
- 여러 스레드 또는 프로세스가 shared resource에 동시 접근하지 못하도록 critical section에 대한 접근 조정

***2. Progress (진행)***
- 어떤 스레드가 임계 영역에 진입하기 위해 대기 중인 상태에서, 다른 스레드가 진입할 수 있음을 보장해야 함

***3. Bounded Waiting (제한된 대기)***
- 한 스레드가 임계 영역에 진입하기 위해 대기하는 시간은 제한되어야 함
- 특정 스레드가 계속해서 다른 스레드에게 우선권을 주며 무제한으로 대기하는 상황이 발생하지 않도록 해야 함

---
# 프로세스 동기화 메커니즘 : Spinlock & Mutex & Semaphore
- 동기화 메커니즘은 여러 개의 스레드가 **공유 자원에 동시 접근하는 것을 조절하고 조율하는데 사용되는 기술**
- 주로 운영체제의 **커널(Kernel)에서** 사용됨
- 동기화 메커니즘으로 사용되는 도구로는 **Spinlock, Mutex, Semaphore** 등이 있음

&rarr; ***다중 스레드 환경에서 공유 자원에 대한 접근을 조절하여 Critical section에서의 Race Condition과 같은 문제를 해결하기 위해 사용됨***

### Spinlock
- Critical section이 락이 걸려 진입이 불가능할 때, **임계영역이 unlock되어 진입이 가능해질 때까지 루프를 돌면서 재시도하여 스레드가 CPU를 점유하고 있는 상태**
- 무의미한 코드를 계속 수행하며 언락되길 기다리기 때문에 **Busy Waiting** 상태임

    &rarr; 오랜 시간 동안 언락되지 않으면 해당 시간동안 계속 CPU를 점유하고 있으므로 **오버헤드**가 존재함
  
- 운영체제의 스케줄링 지원을 받지 않기 때문에 해당 스레드에 대한 **Context switching이 일어나지 않음**

    &rarr; 멀티 프로세스 시스템에서만 사용 가능
- 상태가 오직 **Lock / Unlock**만 존재하므로 한번에 하나의 컴포넌트만 접근 가능 & 주체가 동일해야함

### Mutex
- 상태가 **Lock / Unlock**만 존재한다는 점은 spinlock과 동일
- Spinlock이 임계영역이 언락되어 권한을 획득하기까지 Busy Waiting 상태를 유지한다면, mutex는 **Sleep 상태로 들어갔다 Wakeup 되면 다시 권한 획득을 시도함**
- ***Locking 메커니즘으로 락을 걸은 스레드만이 임계영역을 나갈때 락을 해제할 수 있음***
- 시스템 전반의 성능에 영향을 주지 않고 길게 처리해야하는 작업에 주로 사용 &rarr; ex: 스레드 작업

### Semaphore
- spinlock & mutex와 달리 **표현형이 정수형** &rarr; 하나 이상의 컴포넌트가 공유자원에 접근할 수 있도록 허용
- 컴포넌트가 특정 자원에 접근할 때 **semWait이 먼저 호출되어 임계영역에 들어갈 수 있는지 먼저 확인**
- 임계영역에 접근이 가능하면 **semWait을 빠져나와 임계영역에 들어가고, 이후 semSignal이 호출되어 임계영역에서 빠져나옴**
- ***Signaling 메커니즘으로 락을 걸지 않은 스레드도 signal을 통해 락을 해제할 수 있음***

<details>
<summary>semWait & semSignal</summary>

- **semWait 연산**
    - 세마포어의 값을 감소
    - 만약 값이 음수가 되면 semWait을 호출한 스레드는 블록되지만 음수가 아니면 작업 수행
- **semSignal 연산**
    - 세마포어의 값을 증가
    - 만약 값이 양수가 아니면 semWait 연산에 의해 블록된 스레드를 다시 wake 시킴

</details>

<details>
<summary>사용할 수 있는 자원의 수(= 세마포어 값)에 따른 두가지 유형</summary>

- **Counting Semaphore (개수 세마포어)**
    - 도메인이 0이상인 임의의 정수값인 세마포어
    - 여러개의 자원을 가질 수 있으며 제한된 자원을 가지고 액세스 작업할 때 사용
- **Binary Semaphore (이진 세마포어)**
    - 0 또는 1값만 가질 수 있는 세마포어
    - 임계영역 문제를 해결하는데에 사용하며. 자원이 하나이므로 뮤텍스로도 사용 가능

</details>
