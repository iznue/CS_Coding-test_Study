# Multi-Process & Multi-Thread

---
## Multi Process
- 하나의 응용프로그램을 여러 개의 프로세스로 구성해 각 프로세스가 하나의 작업(태스크)을 처리하도록 함

- 장점
    - 여러 자식 프로세스 중 하나에 문제가 발생하면 그 **자식 프로세스만 죽는 것 이상으로 다른 영향이 확산되지 않음**

- 단점
    - **Context Switching에서의 오버헤드 증가**
        - 프로세스는 각 독립된 메모리 영역을 할당받았기에 프로세스 사이에서 공유하는 메모리가 없어, context switching 발생 시 **캐쉬에 있는 모든 데이터를 모두 리셋하고 다시 캐쉬 정보를 불러와야 하므로 오버헤드 발생**
    - **프로세스 사이의 어렵고 복잡한 통신 기법(IPC)**
        - 프로세스는 각각 독립된 메모리 영역을 할당받았기에 별도의 설비 없이 서로간에 통신이 어려움

          &rarr; 이를 위해 커널 영역에서 제공하는 ipc 설비를 이용해 프로세스 간의 통신 진행
        
        - IPC(Inter Process Communication) : 커널 영역에서 제공하는 내부 프로세스 간의 통신
  
---
## Multi Thread
- 하나의 응용프로그램을 여러 개의 스레드로 구성하고 각 스레드로 하여금 하나의 작업을 처리하게 함
- 윈도우, 리눅스 등 많은 OS들이 멀티 프로세싱을 지원하지만 멀티 스레딩을 기본으로 함

  &rarr; 대표적인 멀티 스레드 응용 프로그램 : 웹 서버

- 장점
    - **시스템 자원 소모 감소 (자원 효율성 증대)** &rarr; 프로세스를 생성해 자원을 할당하는 **system call**이 줄음
    - **시스템 처리량 증가 (처리 비용 감소)**
        - 스레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어듦

          &rarr; 스레드 사이의 작업량 감소

          &rarr; context switching이 빠름
          
    - **간단한 통신 방법으로 인한 프로그램 응답 시간 단축**
        - 프로세스 내의 stack 영역을 제외한 모든 메모리를 공유하므로 응답 시간이 단축됨

- 단점
    - 하나의 스레드에 문제가 발생하면 **전체 프로세스가 영향을 받음**
    - 구현이 어려우며, **자원 공유인 동기화 문제 발생**
    - **디버깅이 어려움**
    - **단일 프로세스 시스템의 경우 효과 기대가 어려움**
 
### 멀티 프로세스 대신 멀티 스레드를 사용하는 이유?
&rarr; 프로그램을 여러 개 키는 것보다 하나의 프로그램 안에서 여러 작업을 해결함

---
***여러 프로세스 (멀티 프로세스)로 할 수 있는 작업들을 하나의 프로세스에서 여러 스레드로 나눠가면서 하는 이유?***

if 단일 스레드를 갖는 프로세스를 여러 개 실행

&rarr; 프로세스와 스레드가 새로 생성 &여러 CPU가 이들을 처리함 &rarr; ***프로세스마다 메모리 할당과 PCB 생성이 일어남***

also 힙 & 스택 영역은 동적 영역에 해당하며 스레드는 프로세스 구조 중 동적영역에 생성됨 

&rarr; 프로세스 개수만큼 정적 영역이 메모리에 추가로 할당되어야 함

also context switching 속도가 느림 

&rarr; 각 프로세스를 context switching 하는 것보다 같은 프로세스를 갖는 스레드에 대해 switching하는 속도가 더 빠름

1. **자원의 효율성 증대**
- 멀티 프로세스로 실행되는 작업을 멀티 스레드로 실행할 경우, 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있음
    - 프로세스 간의 Context Switching시 단순히 CPU 레지스터 교체 뿐만 아니라 RAM과 CPU 사이의 캐쉬 메모리에 대한 데이터까지 초기화되므로 오버헤드가 크게 발생하지만 스레드는 프로세스 내의 메모리를 공유하기 때문에 독립적인 프로세스와 달리 스레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어듦
 
2. **처리 비용 감소 및 응답 시간 단축**
- 프로세스 간의 통신(IPC)보다 스레드 간의 통신의 비용이 적으므로 작업들 간의 통신의 부담이 줄어듦
    - 프로세스의 경우 통신을 하기 위해선 커널에서 제공하는 IPC설비를 별도로 해야되지만 스레드는 stack 영역을 제외한 모든 메모리를 공유하므로 Context Switching시 스레드간의 전환속도가 빠름
 
---
***멀티 스레드의 문맥 교환(context switching)이 단일 스레드보다 빠른 이유?***
- 멀티 스레드는 같은 프로세스에 속하므로 정적 데이터를 공유함 (데이터, 코드 영역 공유)
- 캐시는 CPU에서 읽어들인 메모리의 데이터를 저장하고 있다가 CPU가 다시 데이터를 요구할 때 메모리에서 전달함

&rarr; **프로세스가 같으므로** 문맥교환이 발생하고 PCB 내용을 기반으로 CPU를 셋팅할 때 데이터와 코드 영역을 메모리 영역에서 빠르게 읽어옴

---
### 동기화 문제 
- 멀티 스레드가 프로세스 내의 같은 자원을 공유함으로써 발생

&rarr; 스레드들에게 하나의 자원에 대한 **처리 권한을 주거나 순서를 조정하는 기법**을 사용함

***Mutex & Semaphore 이용***
